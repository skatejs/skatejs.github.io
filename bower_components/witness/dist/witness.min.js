!function(){"use strict";function a(a,b){if(a)if(a.hasOwnProperty){for(var c in a)if(a.hasOwnProperty(c)&&b(a[c],c)===!1)return}else if(a.length)for(var c=0;c<a.length;c++)if(b(a[c],c)===!1)return}function b(a){this.isArray=Array.isArray(a),this.obj=a,this.init()}function c(a){var c=b.find(a);return c||(c=new b(a),d.push(a),e.push(c)),c}var d=[],e=[],f=["add","update","delete","change"],g=function(){var a=0,b=["ms","moz","webkit","o"];if(window.requestAnimationFrame)return window.requestAnimationFrame;for(var c=0;c<b.length;++c){var d=b[c]+"RequestAnimationFrame";if("function"==typeof window[d])return window[d]}return window.requestAnimationFrame?void 0:function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}}(),h=function(){return window.cancelAnimationFrame?window.cancelAnimationFrame:function(a){clearTimeout(a)}}();b.find=function(a){var b=d.indexOf(a);return-1===b?!1:e[b]},b.prototype={constructor:b,init:function(){var a=this;return this.listeners={},this.timeout=!1,f.forEach(function(b){a.listeners[b]=[]}),this},on:function(a,b){return this.listening()||this.start(),this.listeners[a].push(b),this},off:function(a,b){return b?this.listeners[a].splice(this.listeners[a].indexOf(b),1):this.listeners[a]=[],this.listening()||this.stop(),this},notify:function(a){var b=this;return a.forEach(function(a){b.listeners[a.type].forEach(function(b){b(a)}),b.listeners.change.forEach(function(b){b(a)})}),this},diff:function(){var b=this,c=[];return this.isArray&&this.obj.length===this.state.length?c:(a(this.state,function(a,d){var e=b.isArray?-1===b.obj.indexOf(a):"undefined"==typeof b.obj[d];e&&c.push({object:b.obj,type:"delete",name:d,oldValue:a,newValue:void 0})}),a(this.obj,function(a,d){var e=b.isArray?-1===b.state.indexOf(a):"undefined"==typeof b.state[d],f=b.isArray?b.obj.length===b.state.length&&b.state[d]!==a:b.state[d]!==a;(e||f)&&c.push({object:b.obj,type:"undefined"==typeof b.state[d]?"add":"update",name:d,oldValue:"undefined"==typeof b.state[d]?void 0:b.state[d],newValue:a})}),c)},save:function(){var b=this;return this.state=b.isArray?[]:{},a(this.obj,function(a,c){b.state[c]=a}),this},listening:function(){for(var a=0;a<f.length;a++)if(this.listeners[f[a]].length)return!0;return!1},start:function(){function a(){var c=b.diff();c.length&&(b.save(),b.notify(c)),g(a)}var b=this;return this.save(),this.timeout=g(a),this},stop:function(){var a=this;return h(this.timeout),this.state={},this.timeout=!1,f.forEach(function(b){a.listeners[b]=[]}),this},destroy:function(){return this.stop(),d.splice(d.indexOf(this.obj),1),e.splice(e.indexOf(this),1),delete this.obj,this}},"function"==typeof define&&define.amd?define("witness",function(){return c}):window.witness=c}();